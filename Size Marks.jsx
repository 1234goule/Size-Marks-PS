// v1.1
function setScaleF(e){return function(t){return t/e}}function formatValueWithUnits(e,t,a){return a=a||"",""+e+a+t}function drawLine(e,t){var a=makePoint(e),r=makePoint(t),s=new SubPathInfo;s.closed=!1,s.operation=ShapeOperation.SHAPEXOR,s.entireSubPath=[a,r];var n=doc.pathItems.add("Line",[s]);n.strokePath(ToolType.PENCIL),n.remove()}function makePoint(e){for(var t=0;t<e.length;t++)e[t]=scale(e[t]);var a=new PathPointInfo;return a.anchor=e,a.leftDirection=e,a.rightDirection=e,a.kind=PointKind.CORNERPOINT,a}function pickTool(e){var t=charIDToTypeID("slct"),a=new ActionDescriptor,r=charIDToTypeID("null"),s=new ActionReference,n=stringIDToTypeID(e);s.putClass(n),a.putReference(r,s),executeAction(t,a,DialogModes.NO)}function makeTextLayer(){var e=new ActionDescriptor,t=new ActionReference;t.putClass(app.charIDToTypeID("TxLr")),e.putReference(app.charIDToTypeID("null"),t);var a=new ActionDescriptor;a.putString(app.charIDToTypeID("Txt "),"text");var r=new ActionList;return a.putList(app.charIDToTypeID("Txtt"),r),e.putObject(app.charIDToTypeID("Usng"),app.charIDToTypeID("TxLr"),a),executeAction(app.charIDToTypeID("Mk  "),e,DialogModes.NO),doc.activeLayer}function setPenToolSize(e){var t=charIDToTypeID("slct"),a=new ActionDescriptor,r=charIDToTypeID("null"),s=new ActionReference,n=charIDToTypeID("PcTl");s.putClass(n),a.putReference(r,s),executeAction(t,a,DialogModes.NO);var o=charIDToTypeID("setd"),l=new ActionDescriptor,i=new ActionReference,c=charIDToTypeID("Brsh"),p=charIDToTypeID("Ordn"),T=charIDToTypeID("Trgt");i.putEnumerated(c,p,T),l.putReference(r,i);var u=charIDToTypeID("T   "),y=stringIDToTypeID("masterDiameter"),I=charIDToTypeID("#Pxl");a.putUnitDouble(y,I,e),l.putObject(u,c,a),executeAction(o,l,DialogModes.NO)}var doc=null,docIsExist=!1,selBounds=null,selIsExist=!1,store={activeLayer:null,rulerUnits:app.preferences.rulerUnits,typeUnits:app.preferences.typeUnits,font:null};app.preferences.rulerUnits=Units.PIXELS,app.preferences.typeUnits=TypeUnits.POINTS;try{doc=app.activeDocument,docIsExist=!0}catch(e){alert("Size Marks Script: no document\nUse File â†’ New... to create one")}if(docIsExist)try{selBounds=doc.selection.bounds,selIsExist=!0}catch(e){alert("Size Marks Script: no selection\nUse Rectangular Marquee Tool (M) to create one")}if(docIsExist&&selIsExist){var halfMark=3,txtMargin=5,baseRes=72,decimPlaces=1,layerOpacity=65,docRes=doc.resolution,scaleRatio=docRes/baseRes,scale=setScaleF(scaleRatio),realUnits="px",scaledUnits="pt",charThinSpace="\u200A",selX1=selBounds[0].value,selX2=selBounds[2].value-1,selY1=selBounds[1].value,selY2=selBounds[3].value-1,selWidth=selX2-selX1,selHeight=selY2-selY1,val=0,txtLayerPos=[0,0],layerNamePrefix="MSRMNT",txtJ11n=Justification.LEFT;store.activeLayer=doc.activeLayer,doc.selection.deselect();var markLayer=doc.artLayers.add();setPenToolSize(1),selWidth>selHeight?(drawLine([selX1,selY1],[selX2,selY1]),drawLine([selX1,selY1-halfMark],[selX1,selY1+halfMark]),drawLine([selX2,selY1-halfMark],[selX2,selY1+halfMark]),layerNamePrefix="W",val=selWidth+1,txtLayerPos=[selX1+val/2,selY1-txtMargin],txtJ11n=Justification.CENTER):(drawLine([selX1,selY1],[selX1,selY2]),drawLine([selX1-halfMark,selY1],[selX1+halfMark,selY1]),drawLine([selX1-halfMark,selY2],[selX1+halfMark,selY2]),layerNamePrefix="H",val=selHeight+1,txtLayerPos=[selX1+txtMargin,selY1+val/2+4],txtJ11n=Justification.LEFT),markLayer.opacity=85,markLayer.move(store.activeLayer,ElementPlacement.PLACEBEFORE);var txtLayer=makeTextLayer(),txtLayerItem=txtLayer.textItem;store.font=txtLayerItem.font,txtLayerItem.font="ArialMT",txtLayerItem.autoKerning=AutoKernType.OPTICAL,txtLayer.translate(txtLayerPos[0],txtLayerPos[1]),txtLayerItem.justification=txtJ11n,txtLayerItem.color=app.foregroundColor;var label="";baseRes!==docRes&&(label=formatValueWithUnits(scale(val).toFixed(decimPlaces),scaledUnits,charThinSpace)+" / "),label+=formatValueWithUnits(val,realUnits,charThinSpace),txtLayerItem.contents=label,txtLayer.rasterize(RasterizeType.TEXTCONTENTS),txtLayer.move(markLayer,ElementPlacement.PLACEBEFORE),txtLayer.opacity=layerOpacity,txtLayer.merge().name=layerNamePrefix+val,app.preferences.rulerUnits=store.rulerUnits,app.preferences.typeUnits=store.typeUnits,pickTool("marqueeRectTool")}
